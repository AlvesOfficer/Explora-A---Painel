local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Teams = game:GetService("Teams")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

local WHITELIST = {
    ["AlvesOfficer"] = true,
    ["stealingbrainrotss2"] = true,
    ["fsijgbh"] = true,
    ["sushdiik"] = true,
    ["pinbarip_mago"] = true,
    ["Linda06265"] = true,
}

local function setupBypass()
    pcall(function()
        local mt = getrawmetatable(game)
        local oldmt = mt
        setreadonly(mt, false)
        
        local oldNamecall = mt.__namecall
        local oldIndex = mt.__index
        local oldNewIndex = mt.__newindex
        
        mt.__namecall = newcclosure(function(self, ...)
            local method = getnamecallmethod()
            local args = {...}
            
            if method == "Kick" or method == "kick" then
                if self == LocalPlayer then
                    return
                end
            end
            
            if method == "FireServer" or method == "InvokeServer" then
                local selfString = tostring(self):lower()
                
                if selfString:find("ban") or selfString:find("kick") or 
                   selfString:find("detect") or selfString:find("report") or
                   selfString:find("flag") or selfString:find("anticheat") or
                   selfString:find("ac") or selfString:find("security") then
                    return
                end
                
                for _, arg in pairs(args) do
                    if type(arg) == "string" then
                        local argLower = arg:lower()
                        if argLower:find("cheat") or argLower:find("hack") or
                           argLower:find("exploit") or argLower:find("script") or
                           argLower:find("ban") or argLower:find("detect") or
                           argLower:find("suspicious") or argLower:find("flag") then
                            return
                        end
                    end
                end
            end
            
            return oldNamecall(self, ...)
        end)
        
        mt.__index = newcclosure(function(self, key)
            if key == "__namecall" or key == "__index" or key == "__newindex" then
                return nil
            end
            return oldIndex(self, key)
        end)
        
        mt.__newindex = newcclosure(function(self, key, value)
            return oldNewIndex(self, key, value)
        end)
        
        setreadonly(mt, true)
    end)
    
    pcall(function()
        for _, connection in pairs(getconnections(LocalPlayer.Idled)) do
            connection:Disable()
        end
    end)
    
    pcall(function()
        if gethiddenproperty then
            gethiddenproperty(LocalPlayer, "DevComputerCameraMode")
        end
    end)
end

setupBypass()

local function checkWhitelist()
    return WHITELIST[LocalPlayer.Name] == true
end

local Config = {
    ESP = {
        Enabled = true,
        ShowNames = true,
        ShowDistance = true,
        TeamCheck = true
    },
    Aimbot = {
        Enabled = true,
        Active = false,
        Mode = "F",
        FOV = 200,
        Smoothness = 15,
        Prediction = 13,
        IgnoreWalls = false,
        TargetPart = "Head",
        ShowFOV = true,
        TeamCheck = false
    },
    Aimbot2 = {
        Enabled = false,
        Active = false,
        MouseButton = "Right"
    },
    Movement = {
        Speed = false,
        SpeedLevel = 1
    },
    Performance = {
        OptimizationEnabled = false,
        QualityLevel = 10
    },
    Recognition = {
        Enabled = true,
        Players = {}
    }
}

local ESPObjects = {}
local RecognitionMarkers = {}
local PlayerConnections = {}
local CustomKey = nil
local WaitingForKey = false
local gameHasTeams = false
local OriginalSettings = {}
local OriginalWalkSpeed = 16
local lastSpeedCheck = 0

local cameraStabilizationEnabled = false
local lastRecoilCompensation = 0
local recoilDelay = 0

local function applySpeed()
    if Config.Movement.Speed then
        pcall(function()
            if LocalPlayer.Character then
                local humanoid = LocalPlayer.Character:FindFirstChild("Humanoid")
                if humanoid then
                    if not OriginalWalkSpeed or OriginalWalkSpeed == 16 then
                        OriginalWalkSpeed = humanoid.WalkSpeed
                    end
                    
                    local speedValues = {
                        [1] = 25,
                        [2] = 40,
                        [3] = 60
                    }
                    
                    humanoid.WalkSpeed = speedValues[Config.Movement.SpeedLevel] or 25
                end
            end
        end)
    else
        pcall(function()
            if LocalPlayer.Character then
                local humanoid = LocalPlayer.Character:FindFirstChild("Humanoid")
                if humanoid then
                    humanoid.WalkSpeed = OriginalWalkSpeed or 16
                end
            end
        end)
    end
end

local qualityLevels = {}
for i = 1, 21 do
    qualityLevels[i] = Enum.QualityLevel["Level" .. string.format("%02d", i)]
end

local optimizationCache = {}

local function applyOptimization()
    pcall(function()
        if not Config.Performance.OptimizationEnabled then
            if OriginalSettings.Quality then
                settings().Rendering.QualityLevel = OriginalSettings.Quality
                OriginalSettings.Quality = nil
            end
            
            task.spawn(function()
                for obj, _ in pairs(optimizationCache) do
                    if obj and obj.Parent then
                        if obj:IsA("Texture") or obj:IsA("Decal") then
                            obj.Transparency = 0
                        end
                    end
                end
                optimizationCache = {}
            end)
            return
        end
        
        if not OriginalSettings.Quality then
            OriginalSettings.Quality = settings().Rendering.QualityLevel
        end
        
        local level = Config.Performance.QualityLevel
        
        settings().Rendering.QualityLevel = qualityLevels[level] or Enum.QualityLevel.Level10
        
        if level <= 3 then
            task.spawn(function()
                local objects = Workspace:GetDescendants()
                local chunkSize = 100
                
                for i = 1, #objects, chunkSize do
                    for j = i, math.min(i + chunkSize - 1, #objects) do
                        local obj = objects[j]
                        if obj:IsA("Texture") or obj:IsA("Decal") then
                            obj.Transparency = 1
                            optimizationCache[obj] = true
                        elseif obj:IsA("BasePart") then
                            obj.Material = Enum.Material.SmoothPlastic
                        end
                    end
                    task.wait()
                end
            end)
        else
            task.spawn(function()
                for obj, _ in pairs(optimizationCache) do
                    if obj and obj.Parent then
                        if obj:IsA("Texture") or obj:IsA("Decal") then
                            obj.Transparency = 0
                        end
                    end
                end
            end)
        end
    end)
end

local lastSpeedCheck = 0

RunService.RenderStepped:Connect(function()
    if Config.Movement.Speed then
        local currentTime = tick()
        if currentTime - lastSpeedCheck >= 0.5 then
            lastSpeedCheck = currentTime
            applySpeed()
        end
    end
end)

RunService.RenderStepped:Connect(function()
    if Config.Combat.NoRecoil then
        pcall(function()
            local character = LocalPlayer.Character
            if character then
                local tool = character:FindFirstChildOfClass("Tool")
                if tool then
                    if not cameraStabilizationEnabled then
                        lastCameraCFrame = Camera.CFrame
                        cameraStabilizationEnabled = true
                        recoilDelay = math.random(8, 25) / 1000
                    end
                    
                    local currentTime = tick()
                    if currentTime - lastRecoilCompensation < recoilDelay then
                        return
                    end
                    
                    local currentCFrame = Camera.CFrame
                    local diff = (currentCFrame.Position - lastCameraCFrame.Position).Magnitude
                    
                    if diff > 0.2 and not Config.Aimbot.Active then
                        local compensation = 0.7 + (math.random(-10, 10) / 100)
                        Camera.CFrame = Camera.CFrame:Lerp(lastCameraCFrame, compensation)
                        lastRecoilCompensation = currentTime
                        recoilDelay = math.random(8, 25) / 1000
                    end
                    
                    lastCameraCFrame = Camera.CFrame
                else
                    cameraStabilizationEnabled = false
                end
            else
                cameraStabilizationEnabled = false
            end
        end)
    else
        cameraStabilizationEnabled = false
        lastCameraCFrame = Camera.CFrame
    end
end)

local TargetPartMap = {
    ["Cabeca"] = "Head",
    ["Peito"] = "UpperTorso",
    ["Barriga"] = "LowerTorso",
    ["Braco Esq"] = "LeftUpperArm",
    ["Braco Dir"] = "RightUpperArm",
    ["Perna Esq"] = "LeftUpperLeg",
    ["Perna Dir"] = "RightUpperLeg"
}

if not checkWhitelist() then
    local BlockScreen = Instance.new("ScreenGui")
    BlockScreen.Name = "BlockScreen"
    BlockScreen.ResetOnSpawn = false
    
    pcall(function()
        if gethui then
            BlockScreen.Parent = gethui()
        else
            BlockScreen.Parent = game:GetService("CoreGui")
        end
    end)
    
    local BlockFrame = Instance.new("Frame")
    BlockFrame.Size = UDim2.new(0, 400, 0, 300)
    BlockFrame.Position = UDim2.new(0.5, -200, 0.5, -150)
    BlockFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    BlockFrame.BorderSizePixel = 3
    BlockFrame.BorderColor3 = Color3.fromRGB(255, 80, 80)
    BlockFrame.Parent = BlockScreen
    
    local BlockCloseBtn = Instance.new("TextButton")
    BlockCloseBtn.Size = UDim2.new(0, 40, 0, 40)
    BlockCloseBtn.Position = UDim2.new(1, -45, 0, 5)
    BlockCloseBtn.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
    BlockCloseBtn.BorderSizePixel = 2
    BlockCloseBtn.BorderColor3 = Color3.fromRGB(200, 80, 80)
    BlockCloseBtn.Text = "X"
    BlockCloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    BlockCloseBtn.TextSize = 20
    BlockCloseBtn.Font = Enum.Font.GothamBold
    BlockCloseBtn.Parent = BlockFrame
    
    BlockCloseBtn.MouseButton1Click:Connect(function()
        BlockScreen:Destroy()
    end)
    
    local BlockTitle = Instance.new("TextLabel")
    BlockTitle.Size = UDim2.new(1, 0, 0, 60)
    BlockTitle.BackgroundTransparency = 1
    BlockTitle.Text = "ðŸ”’ ACESSO NEGADO"
    BlockTitle.TextColor3 = Color3.fromRGB(255, 80, 80)
    BlockTitle.TextSize = 28
    BlockTitle.Font = Enum.Font.GothamBold
    BlockTitle.Parent = BlockFrame
    
    local BlockMsg = Instance.new("TextLabel")
    BlockMsg.Size = UDim2.new(1, -40, 0, 80)
    BlockMsg.Position = UDim2.new(0, 20, 0, 80)
    BlockMsg.BackgroundTransparency = 1
    BlockMsg.Text = "Voce nao tem permissao para usar este script.\n\nCompre acesso permanente por R$ 10,00"
    BlockMsg.TextColor3 = Color3.fromRGB(200, 200, 200)
    BlockMsg.TextSize = 14
    BlockMsg.Font = Enum.Font.Gotham
    BlockMsg.TextWrapped = true
    BlockMsg.Parent = BlockFrame
    
    local DiscordBtn = Instance.new("TextButton")
    DiscordBtn.Size = UDim2.new(0, 300, 0, 50)
    DiscordBtn.Position = UDim2.new(0.5, -150, 0, 180)
    DiscordBtn.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
    DiscordBtn.Text = "ðŸ’¬ COPIAR LINK DO DISCORD"
    DiscordBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    DiscordBtn.TextSize = 16
    DiscordBtn.Font = Enum.Font.GothamBold
    DiscordBtn.Parent = BlockFrame
    
    local DiscordLink = Instance.new("TextLabel")
    DiscordLink.Size = UDim2.new(1, 0, 0, 30)
    DiscordLink.Position = UDim2.new(0, 0, 0, 250)
    DiscordLink.BackgroundTransparency = 1
    DiscordLink.Text = "discord.gg/SewVPQDGX2"
    DiscordLink.TextColor3 = Color3.fromRGB(150, 150, 150)
    DiscordLink.TextSize = 12
    DiscordLink.Font = Enum.Font.GothamBold
    DiscordLink.Parent = BlockFrame
    
    DiscordBtn.MouseButton1Click:Connect(function()
        setclipboard("https://discord.gg/SewVPQDGX2")
        DiscordBtn.Text = "âœ… LINK COPIADO!"
        DiscordBtn.BackgroundColor3 = Color3.fromRGB(67, 181, 129)
        task.wait(2)
        DiscordBtn.Text = "ðŸ’¬ COPIAR LINK DO DISCORD"
        DiscordBtn.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
    end)
    
    return
end

local LoadingScreen = Instance.new("ScreenGui")
LoadingScreen.Name = "LoadingScreen"
LoadingScreen.ResetOnSpawn = false

pcall(function()
    if gethui then
        LoadingScreen.Parent = gethui()
    else
        LoadingScreen.Parent = game:GetService("CoreGui")
    end
end)

local LoadingFrame = Instance.new("Frame")
LoadingFrame.Size = UDim2.new(0, 400, 0, 350)
LoadingFrame.Position = UDim2.new(0.5, -200, 0.5, -175)
LoadingFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
LoadingFrame.BorderSizePixel = 3
LoadingFrame.BorderColor3 = Color3.fromRGB(255, 140, 0)
LoadingFrame.Parent = LoadingScreen

local LoadingLogo = Instance.new("ImageLabel")
LoadingLogo.Size = UDim2.new(0, 140, 0, 140)
LoadingLogo.Position = UDim2.new(0.5, -70, 0, 20)
LoadingLogo.BackgroundTransparency = 1
LoadingLogo.Image = "rbxassetid://79716597981355"
LoadingLogo.ScaleType = Enum.ScaleType.Fit
LoadingLogo.Parent = LoadingFrame

local LoadingTitle = Instance.new("TextLabel")
LoadingTitle.Size = UDim2.new(1, 0, 0, 40)
LoadingTitle.Position = UDim2.new(0, 0, 0, 170)
LoadingTitle.BackgroundTransparency = 1
LoadingTitle.Text = "EXPLOITS A"
LoadingTitle.TextColor3 = Color3.fromRGB(255, 140, 0)
LoadingTitle.TextSize = 28
LoadingTitle.Font = Enum.Font.GothamBold
LoadingTitle.Parent = LoadingFrame

local LoadingStatus = Instance.new("TextLabel")
LoadingStatus.Size = UDim2.new(1, 0, 0, 30)
LoadingStatus.Position = UDim2.new(0, 0, 0, 220)
LoadingStatus.BackgroundTransparency = 1
LoadingStatus.Text = "Inicializando..."
LoadingStatus.TextColor3 = Color3.fromRGB(200, 200, 200)
LoadingStatus.TextSize = 14
LoadingStatus.Font = Enum.Font.Gotham
LoadingStatus.Parent = LoadingFrame

local ProgressBarBG = Instance.new("Frame")
ProgressBarBG.Size = UDim2.new(0.8, 0, 0, 8)
ProgressBarBG.Position = UDim2.new(0.1, 0, 0, 270)
ProgressBarBG.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
ProgressBarBG.BorderSizePixel = 1
ProgressBarBG.BorderColor3 = Color3.fromRGB(60, 60, 60)
ProgressBarBG.Parent = LoadingFrame

local ProgressBar = Instance.new("Frame")
ProgressBar.Size = UDim2.new(0, 0, 1, 0)
ProgressBar.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
ProgressBar.BorderSizePixel = 0
ProgressBar.Parent = ProgressBarBG

local LoadingInfo = Instance.new("TextLabel")
LoadingInfo.Size = UDim2.new(1, 0, 0, 50)
LoadingInfo.Position = UDim2.new(0, 0, 0, 290)
LoadingInfo.BackgroundTransparency = 1
LoadingInfo.Text = "Feito por AlvesOfficer"
LoadingInfo.TextColor3 = Color3.fromRGB(150, 150, 150)
LoadingInfo.TextSize = 12
LoadingInfo.Font = Enum.Font.Gotham
LoadingInfo.Parent = LoadingFrame

task.spawn(function()
    LoadingStatus.Text = "Verificando whitelist..."
    ProgressBar:TweenSize(UDim2.new(0.2, 0, 1, 0), "Out", "Quad", 0.3, true)
    task.wait(0.5)
    
    LoadingStatus.Text = "Carregando bypass..."
    ProgressBar:TweenSize(UDim2.new(0.4, 0, 1, 0), "Out", "Quad", 0.3, true)
    task.wait(0.5)
    
    LoadingStatus.Text = "Configurando interface..."
    ProgressBar:TweenSize(UDim2.new(0.6, 0, 1, 0), "Out", "Quad", 0.3, true)
    task.wait(0.5)
    
    LoadingStatus.Text = "Carregando jogadores..."
    ProgressBar:TweenSize(UDim2.new(0.8, 0, 1, 0), "Out", "Quad", 0.3, true)
    task.wait(0.5)
    
    LoadingStatus.Text = "Finalizando..."
    ProgressBar:TweenSize(UDim2.new(1, 0, 1, 0), "Out", "Quad", 0.3, true)
    task.wait(0.5)
    
    LoadingScreen:Destroy()
end)

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "GUI_" .. tostring(math.random(100000, 999999))
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.IgnoreGuiInset = true
ScreenGui.Enabled = false

pcall(function()
    if gethui then
        ScreenGui.Parent = gethui()
    elseif syn and syn.protect_gui then
        syn.protect_gui(ScreenGui)
        ScreenGui.Parent = game:GetService("CoreGui")
    else
        ScreenGui.Parent = game:GetService("CoreGui")
    end
end)

if not ScreenGui.Parent then
    ScreenGui.Parent = game:GetService("CoreGui")
end

task.spawn(function()
    task.wait(2.5)
    ScreenGui.Enabled = true
end)

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 400, 0, 600)
MainFrame.Position = UDim2.new(0.5, -200, 0.5, -300)
MainFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
MainFrame.BorderSizePixel = 3
MainFrame.BorderColor3 = Color3.fromRGB(255, 140, 0)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 50)
Header.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Header.BorderSizePixel = 0
Header.Parent = MainFrame

local HeaderLine = Instance.new("Frame")
HeaderLine.Size = UDim2.new(1, 0, 0, 3)
HeaderLine.Position = UDim2.new(0, 0, 1, 0)
HeaderLine.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
HeaderLine.BorderSizePixel = 0
HeaderLine.Parent = Header

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -150, 0, 30)
Title.Position = UDim2.new(0, 10, 0, 5)
Title.BackgroundTransparency = 1
Title.Text = "EXPLOITS A"
Title.TextColor3 = Color3.fromRGB(255, 140, 0)
Title.TextSize = 22
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.TextStrokeTransparency = 0
Title.Parent = Header

local Version = Instance.new("TextLabel")
Version.Size = UDim2.new(0, 150, 0, 15)
Version.Position = UDim2.new(0, 10, 0, 32)
Version.BackgroundTransparency = 1
Version.Text = "Feito por AlvesOfficer"
Version.TextColor3 = Color3.fromRGB(180, 180, 180)
Version.TextSize = 11
Version.Font = Enum.Font.GothamBold
Version.TextXAlignment = Enum.TextXAlignment.Left
Version.Parent = Header

local MinimizeBtn = Instance.new("TextButton")
MinimizeBtn.Size = UDim2.new(0, 40, 0, 40)
MinimizeBtn.Position = UDim2.new(1, -90, 0, 5)
MinimizeBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MinimizeBtn.BorderSizePixel = 2
MinimizeBtn.BorderColor3 = Color3.fromRGB(80, 80, 80)
MinimizeBtn.Text = "_"
MinimizeBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
MinimizeBtn.TextSize = 20
MinimizeBtn.Font = Enum.Font.GothamBold
MinimizeBtn.Parent = Header

local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 40, 0, 40)
CloseBtn.Position = UDim2.new(1, -45, 0, 5)
CloseBtn.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
CloseBtn.BorderSizePixel = 2
CloseBtn.BorderColor3 = Color3.fromRGB(200, 80, 80)
CloseBtn.Text = "X"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.TextSize = 18
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Parent = Header

local Content = Instance.new("ScrollingFrame")
Content.Size = UDim2.new(1, -20, 1, -65)
Content.Position = UDim2.new(0, 10, 0, 55)
Content.BackgroundTransparency = 1
Content.BorderSizePixel = 0
Content.ScrollBarThickness = 8
Content.ScrollBarImageColor3 = Color3.fromRGB(255, 140, 0)
Content.CanvasSize = UDim2.new(0, 0, 0, 1550)
Content.Parent = MainFrame

local currentY = 0

local function createSection(text)
    local section = Instance.new("Frame")
    section.Size = UDim2.new(1, 0, 0, 35)
    section.Position = UDim2.new(0, 0, 0, currentY)
    section.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    section.BorderSizePixel = 2
    section.BorderColor3 = Color3.fromRGB(50, 50, 50)
    section.Parent = Content
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -15, 1, 0)
    label.Position = UDim2.new(0, 15, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 140, 0)
    label.TextSize = 14
    label.Font = Enum.Font.GothamBold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = section
    
    local line = Instance.new("Frame")
    line.Size = UDim2.new(1, 0, 0, 2)
    line.Position = UDim2.new(0, 0, 1, 0)
    line.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
    line.BorderSizePixel = 0
    line.Parent = section
    
    currentY = currentY + 40
    return section
end

local function createToggle(text, defaultValue)
    local toggle = Instance.new("Frame")
    toggle.Size = UDim2.new(1, 0, 0, 40)
    toggle.Position = UDim2.new(0, 0, 0, currentY)
    toggle.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    toggle.BorderSizePixel = 2
    toggle.BorderColor3 = Color3.fromRGB(40, 40, 40)
    toggle.Parent = Content
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0, 250, 1, 0)
    label.Position = UDim2.new(0, 15, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(230, 230, 230)
    label.TextSize = 13
    label.Font = Enum.Font.GothamBold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = toggle
    
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 80, 0, 30)
    button.Position = UDim2.new(1, -90, 0, 5)
    button.BackgroundColor3 = defaultValue and Color3.fromRGB(80, 180, 80) or Color3.fromRGB(180, 80, 80)
    button.BorderSizePixel = 2
    button.BorderColor3 = Color3.fromRGB(100, 100, 100)
    button.Text = defaultValue and "ON" or "OFF"
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 13
    button.Font = Enum.Font.GothamBold
    button.Parent = toggle
    
    currentY = currentY + 45
    
    return {Frame = toggle, Button = button, Value = defaultValue}
end

local function createSlider(text, min, max, defaultValue, suffix)
    local slider = Instance.new("Frame")
    slider.Size = UDim2.new(1, 0, 0, 55)
    slider.Position = UDim2.new(0, 0, 0, currentY)
    slider.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    slider.BorderSizePixel = 2
    slider.BorderColor3 = Color3.fromRGB(40, 40, 40)
    slider.Parent = Content
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.6, 0, 0, 22)
    label.Position = UDim2.new(0, 15, 0, 8)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(230, 230, 230)
    label.TextSize = 13
    label.Font = Enum.Font.GothamBold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = slider
    
    local valueLabel = Instance.new("TextLabel")
    valueLabel.Size = UDim2.new(0, 90, 0, 22)
    valueLabel.Position = UDim2.new(1, -100, 0, 8)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = tostring(defaultValue) .. (suffix or "")
    valueLabel.TextColor3 = Color3.fromRGB(255, 140, 0)
    valueLabel.TextSize = 13
    valueLabel.Font = Enum.Font.GothamBold
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.Parent = slider
    
    local track = Instance.new("Frame")
    track.Size = UDim2.new(1, -30, 0, 12)
    track.Position = UDim2.new(0, 15, 0, 36)
    track.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    track.BorderSizePixel = 2
    track.BorderColor3 = Color3.fromRGB(60, 60, 60)
    track.Parent = slider
    
    local fill = Instance.new("Frame")
    fill.Size = UDim2.new((defaultValue - min) / (max - min), 0, 1, 0)
    fill.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
    fill.BorderSizePixel = 0
    fill.Parent = track
    
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 1, 0)
    button.BackgroundTransparency = 1
    button.Text = ""
    button.Parent = track
    
    currentY = currentY + 60
    
    return {Frame = slider, Track = track, Fill = fill, Button = button, ValueLabel = valueLabel, Min = min, Max = max, Suffix = suffix or "", Value = defaultValue}
end

local function createTargetSelector()
    local selector = Instance.new("Frame")
    selector.Size = UDim2.new(1, 0, 0, 110)
    selector.Position = UDim2.new(0, 0, 0, currentY)
    selector.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    selector.BorderSizePixel = 2
    selector.BorderColor3 = Color3.fromRGB(40, 40, 40)
    selector.Parent = Content
    
    local targets = {"Cabeca", "Peito", "Barriga", "Braco Esq", "Braco Dir", "Perna Esq", "Perna Dir"}
    local buttons = {}
    
    for i, target in ipairs(targets) do
        local row = math.floor((i - 1) / 2)
        local col = (i - 1) % 2
        
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0, 180, 0, 32)
        btn.Position = UDim2.new(0, 10 + (col * 190), 0, 8 + (row * 37))
        btn.BackgroundColor3 = target == "Cabeca" and Color3.fromRGB(255, 140, 0) or Color3.fromRGB(35, 35, 35)
        btn.BorderSizePixel = 2
        btn.BorderColor3 = Color3.fromRGB(70, 70, 70)
        btn.Text = target
        btn.TextColor3 = Color3.fromRGB(255, 255, 255)
        btn.TextSize = 12
        btn.Font = Enum.Font.GothamBold
        btn.Parent = selector
        
        buttons[target] = btn
    end
    
    currentY = currentY + 115
    
    return {Frame = selector, Buttons = buttons}
end

createSection("FUNCOES PRINCIPAIS")
local ESPToggle = createToggle("ESP", Config.ESP.Enabled)
local TeamCheckToggle = createToggle("ESP POR TIME", Config.ESP.TeamCheck)
local ESPDistanceToggle = createToggle("MOSTRAR DISTANCIA", Config.ESP.ShowDistance)
local AimToggle = createToggle("AIMBOT", Config.Aimbot.Enabled)
local FOVToggle = createToggle("MOSTRAR FOV", Config.Aimbot.ShowFOV)
local AimTeamToggle = createToggle("AIMBOT TEAM", Config.Aimbot.TeamCheck)
local WallToggle = createToggle("IGNORAR OBSTACULOS", Config.Aimbot.IgnoreWalls)
local RecogToggle = createToggle("RECONHECIMENTO", Config.Recognition.Enabled)

createSection("MOVIMENTO")
local SpeedToggle = createToggle("SPEED BOOST", Config.Movement.Speed)

createSection("AIMBOT 2 (AIM ON CLICK)")
local Aimbot2Toggle = createToggle("AIMBOT 2", Config.Aimbot2.Enabled)

local aimbot2Frame = Instance.new("Frame")
aimbot2Frame.Size = UDim2.new(1, 0, 0, 50)
aimbot2Frame.Position = UDim2.new(0, 0, 0, currentY)
aimbot2Frame.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
aimbot2Frame.BorderSizePixel = 2
aimbot2Frame.BorderColor3 = Color3.fromRGB(40, 40, 40)
aimbot2Frame.Parent = Content

local aimbot2Label = Instance.new("TextLabel")
aimbot2Label.Size = UDim2.new(0, 150, 1, 0)
aimbot2Label.Position = UDim2.new(0, 15, 0, 0)
aimbot2Label.BackgroundTransparency = 1
aimbot2Label.Text = "Botao do Mouse"
aimbot2Label.TextColor3 = Color3.fromRGB(230, 230, 230)
aimbot2Label.TextSize = 13
aimbot2Label.Font = Enum.Font.GothamBold
aimbot2Label.TextXAlignment = Enum.TextXAlignment.Left
aimbot2Label.Parent = aimbot2Frame

local aimbot2BtnLeft = Instance.new("TextButton")
aimbot2BtnLeft.Size = UDim2.new(0, 90, 0, 35)
aimbot2BtnLeft.Position = UDim2.new(1, -185, 0, 7.5)
aimbot2BtnLeft.BackgroundColor3 = Config.Aimbot2.MouseButton == "Left" and Color3.fromRGB(255, 140, 0) or Color3.fromRGB(35, 35, 35)
aimbot2BtnLeft.BorderSizePixel = 2
aimbot2BtnLeft.BorderColor3 = Color3.fromRGB(70, 70, 70)
aimbot2BtnLeft.Text = "Esquerdo"
aimbot2BtnLeft.TextColor3 = Color3.fromRGB(255, 255, 255)
aimbot2BtnLeft.TextSize = 11
aimbot2BtnLeft.Font = Enum.Font.GothamBold
aimbot2BtnLeft.Parent = aimbot2Frame

local aimbot2BtnRight = Instance.new("TextButton")
aimbot2BtnRight.Size = UDim2.new(0, 90, 0, 35)
aimbot2BtnRight.Position = UDim2.new(1, -90, 0, 7.5)
aimbot2BtnRight.BackgroundColor3 = Config.Aimbot2.MouseButton == "Right" and Color3.fromRGB(255, 140, 0) or Color3.fromRGB(35, 35, 35)
aimbot2BtnRight.BorderSizePixel = 2
aimbot2BtnRight.BorderColor3 = Color3.fromRGB(70, 70, 70)
aimbot2BtnRight.Text = "Direito"
aimbot2BtnRight.TextColor3 = Color3.fromRGB(255, 255, 255)
aimbot2BtnRight.TextSize = 11
aimbot2BtnRight.Font = Enum.Font.GothamBold
aimbot2BtnRight.Parent = aimbot2Frame

local Aimbot2Selector = {
    Frame = aimbot2Frame,
    BtnLeft = aimbot2BtnLeft,
    BtnRight = aimbot2BtnRight
}

currentY = currentY + 55

createSection("OTIMIZACAO")
local OptToggle = createToggle("OTIMIZACAO GRAFICA", Config.Performance.OptimizationEnabled)
local QualitySlider = createSlider("Nivel de Qualidade", 1, 21, Config.Performance.QualityLevel, "")

createSection("MODO AIMBOT")

local modeFrame = Instance.new("Frame")
modeFrame.Size = UDim2.new(1, 0, 0, 40)
modeFrame.Position = UDim2.new(0, 0, 0, currentY)
modeFrame.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
modeFrame.BorderSizePixel = 2
modeFrame.BorderColor3 = Color3.fromRGB(40, 40, 40)
modeFrame.Parent = Content

local modeLabel = Instance.new("TextLabel")
modeLabel.Size = UDim2.new(0, 120, 1, 0)
modeLabel.Position = UDim2.new(0, 15, 0, 0)
modeLabel.BackgroundTransparency = 1
modeLabel.Text = "Tecla de Ativacao"
modeLabel.TextColor3 = Color3.fromRGB(230, 230, 230)
modeLabel.TextSize = 13
modeLabel.Font = Enum.Font.GothamBold
modeLabel.TextXAlignment = Enum.TextXAlignment.Left
modeLabel.Parent = modeFrame

local modeBtnF = Instance.new("TextButton")
modeBtnF.Size = UDim2.new(0, 60, 0, 30)
modeBtnF.Position = UDim2.new(1, -245, 0, 5)
modeBtnF.BackgroundColor3 = Config.Aimbot.Mode == "F" and Color3.fromRGB(255, 140, 0) or Color3.fromRGB(35, 35, 35)
modeBtnF.BorderSizePixel = 2
modeBtnF.BorderColor3 = Color3.fromRGB(70, 70, 70)
modeBtnF.Text = "F"
modeBtnF.TextColor3 = Color3.fromRGB(255, 255, 255)
modeBtnF.TextSize = 13
modeBtnF.Font = Enum.Font.GothamBold
modeBtnF.Parent = modeFrame

local modeBtnCtrl = Instance.new("TextButton")
modeBtnCtrl.Size = UDim2.new(0, 80, 0, 30)
modeBtnCtrl.Position = UDim2.new(1, -180, 0, 5)
modeBtnCtrl.BackgroundColor3 = Config.Aimbot.Mode == "CTRL" and Color3.fromRGB(255, 140, 0) or Color3.fromRGB(35, 35, 35)
modeBtnCtrl.BorderSizePixel = 2
modeBtnCtrl.BorderColor3 = Color3.fromRGB(70, 70, 70)
modeBtnCtrl.Text = "CTRL"
modeBtnCtrl.TextColor3 = Color3.fromRGB(255, 255, 255)
modeBtnCtrl.TextSize = 13
modeBtnCtrl.Font = Enum.Font.GothamBold
modeBtnCtrl.Parent = modeFrame

local modeBtnCustom = Instance.new("TextButton")
modeBtnCustom.Size = UDim2.new(0, 90, 0, 30)
modeBtnCustom.Position = UDim2.new(1, -95, 0, 5)
modeBtnCustom.BackgroundColor3 = Config.Aimbot.Mode ~= "F" and Config.Aimbot.Mode ~= "CTRL" and Color3.fromRGB(255, 140, 0) or Color3.fromRGB(35, 35, 35)
modeBtnCustom.BorderSizePixel = 2
modeBtnCustom.BorderColor3 = Color3.fromRGB(70, 70, 70)
modeBtnCustom.Text = Config.Aimbot.Mode ~= "F" and Config.Aimbot.Mode ~= "CTRL" and Config.Aimbot.Mode or "CUSTOM"
modeBtnCustom.TextColor3 = Color3.fromRGB(255, 255, 255)
modeBtnCustom.TextSize = 11
modeBtnCustom.Font = Enum.Font.GothamBold
modeBtnCustom.Parent = modeFrame

local AimModeSelector = {
    Frame = modeFrame,
    ButtonF = modeBtnF,
    ButtonCtrl = modeBtnCtrl,
    ButtonCustom = modeBtnCustom
}

currentY = currentY + 45

createSection("CONFIGURACOES AIMBOT")
local SmoothSlider = createSlider("Suavidade", 0, 100, Config.Aimbot.Smoothness, "%")
local PredSlider = createSlider("Predicao", 0, 100, Config.Aimbot.Prediction, "%")
local FOVSlider = createSlider("Tamanho FOV", 10, 500, Config.Aimbot.FOV, "px")

createSection("CONFIGURACOES MOVIMENTO")

local speedLevelFrame = Instance.new("Frame")
speedLevelFrame.Size = UDim2.new(1, 0, 0, 50)
speedLevelFrame.Position = UDim2.new(0, 0, 0, currentY)
speedLevelFrame.BackgroundColor3 = Color3.fromRGB(22, 22, 22)
speedLevelFrame.BorderSizePixel = 2
speedLevelFrame.BorderColor3 = Color3.fromRGB(40, 40, 40)
speedLevelFrame.Parent = Content

local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(0, 150, 1, 0)
speedLabel.Position = UDim2.new(0, 15, 0, 0)
speedLabel.BackgroundTransparency = 1
speedLabel.Text = "Nivel de Velocidade"
speedLabel.TextColor3 = Color3.fromRGB(230, 230, 230)
speedLabel.TextSize = 13
speedLabel.Font = Enum.Font.GothamBold
speedLabel.TextXAlignment = Enum.TextXAlignment.Left
speedLabel.Parent = speedLevelFrame

local speedBtn1 = Instance.new("TextButton")
speedBtn1.Size = UDim2.new(0, 55, 0, 35)
speedBtn1.Position = UDim2.new(1, -185, 0, 7.5)
speedBtn1.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
speedBtn1.BorderSizePixel = 2
speedBtn1.BorderColor3 = Color3.fromRGB(70, 70, 70)
speedBtn1.Text = "Nivel 1"
speedBtn1.TextColor3 = Color3.fromRGB(255, 255, 255)
speedBtn1.TextSize = 11
speedBtn1.Font = Enum.Font.GothamBold
speedBtn1.Parent = speedLevelFrame

local speedBtn2 = Instance.new("TextButton")
speedBtn2.Size = UDim2.new(0, 55, 0, 35)
speedBtn2.Position = UDim2.new(1, -125, 0, 7.5)
speedBtn2.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
speedBtn2.BorderSizePixel = 2
speedBtn2.BorderColor3 = Color3.fromRGB(70, 70, 70)
speedBtn2.Text = "Nivel 2"
speedBtn2.TextColor3 = Color3.fromRGB(255, 255, 255)
speedBtn2.TextSize = 11
speedBtn2.Font = Enum.Font.GothamBold
speedBtn2.Parent = speedLevelFrame

local speedBtn3 = Instance.new("TextButton")
speedBtn3.Size = UDim2.new(0, 55, 0, 35)
speedBtn3.Position = UDim2.new(1, -65, 0, 7.5)
speedBtn3.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
speedBtn3.BorderSizePixel = 2
speedBtn3.BorderColor3 = Color3.fromRGB(70, 70, 70)
speedBtn3.Text = "Nivel 3"
speedBtn3.TextColor3 = Color3.fromRGB(255, 255, 255)
speedBtn3.TextSize = 11
speedBtn3.Font = Enum.Font.GothamBold
speedBtn3.Parent = speedLevelFrame

local SpeedLevelSelector = {
    Frame = speedLevelFrame,
    Btn1 = speedBtn1,
    Btn2 = speedBtn2,
    Btn3 = speedBtn3
}

currentY = currentY + 55

createSection("PARTE ALVO")
local TargetSelector = createTargetSelector()

createSection("RECONHECIMENTO")

local recInputFrame = Instance.new("Frame")
recInputFrame.Size = UDim2.new(1, 0, 0, 40)
recInputFrame.Position = UDim2.new(0, 0, 0, currentY)
recInputFrame.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
recInputFrame.BorderSizePixel = 2
recInputFrame.BorderColor3 = Color3.fromRGB(60, 60, 60)
recInputFrame.Parent = Content

local RecInput = Instance.new("TextBox")
RecInput.Size = UDim2.new(1, -20, 1, -10)
RecInput.Position = UDim2.new(0, 10, 0, 5)
RecInput.BackgroundTransparency = 1
RecInput.PlaceholderText = "Digite o nickname ou apelido..."
RecInput.PlaceholderColor3 = Color3.fromRGB(100, 100, 100)
RecInput.Text = ""
RecInput.TextColor3 = Color3.fromRGB(255, 255, 255)
RecInput.TextSize = 13
RecInput.Font = Enum.Font.GothamBold
RecInput.ClearTextOnFocus = false
RecInput.Parent = recInputFrame

currentY = currentY + 45

local btnFrame = Instance.new("Frame")
btnFrame.Size = UDim2.new(1, 0, 0, 40)
btnFrame.Position = UDim2.new(0, 0, 0, currentY)
btnFrame.BackgroundTransparency = 1
btnFrame.Parent = Content

local RecAddBtn = Instance.new("TextButton")
RecAddBtn.Size = UDim2.new(0, 185, 0, 40)
RecAddBtn.Position = UDim2.new(0, 0, 0, 0)
RecAddBtn.BackgroundColor3 = Color3.fromRGB(80, 180, 80)
RecAddBtn.BorderSizePixel = 2
RecAddBtn.BorderColor3 = Color3.fromRGB(100, 200, 100)
RecAddBtn.Text = "ADICIONAR"
RecAddBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
RecAddBtn.TextSize = 13
RecAddBtn.Font = Enum.Font.GothamBold
RecAddBtn.Parent = btnFrame

local RecRemoveBtn = Instance.new("TextButton")
RecRemoveBtn.Size = UDim2.new(0, 185, 0, 40)
RecRemoveBtn.Position = UDim2.new(0, 195, 0, 0)
RecRemoveBtn.BackgroundColor3 = Color3.fromRGB(180, 80, 80)
RecRemoveBtn.BorderSizePixel = 2
RecRemoveBtn.BorderColor3 = Color3.fromRGB(200, 100, 100)
RecRemoveBtn.Text = "REMOVER"
RecRemoveBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
RecRemoveBtn.TextSize = 13
RecRemoveBtn.Font = Enum.Font.GothamBold
RecRemoveBtn.Parent = btnFrame

currentY = currentY + 45

local RecStatus = Instance.new("TextLabel")
RecStatus.Size = UDim2.new(1, 0, 0, 45)
RecStatus.Position = UDim2.new(0, 0, 0, currentY)
RecStatus.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
RecStatus.BorderSizePixel = 2
RecStatus.BorderColor3 = Color3.fromRGB(60, 60, 60)
RecStatus.Text = "Nenhum jogador marcado"
RecStatus.TextColor3 = Color3.fromRGB(150, 150, 150)
RecStatus.TextSize = 11
RecStatus.Font = Enum.Font.GothamBold
RecStatus.TextWrapped = true
RecStatus.Parent = Content

local function checkTeams()
    local teams = Teams:GetTeams()
    if #teams == 0 then
        gameHasTeams = false
        return
    end
    
    local playersWithTeams = 0
    for _, player in pairs(Players:GetPlayers()) do
        if player.Team then
            playersWithTeams = playersWithTeams + 1
        end
    end
    
    gameHasTeams = playersWithTeams > 0
end

local function getESPColor(player)
    if not Config.ESP.TeamCheck or not gameHasTeams then
        return Color3.fromRGB(255, 255, 255)
    end
    
    if not player.Team or not LocalPlayer.Team then
        return Color3.fromRGB(255, 255, 0)
    end
    
    return player.Team == LocalPlayer.Team and Color3.fromRGB(80, 255, 80) or Color3.fromRGB(255, 80, 80)
end

local function createESP(player)
    if player == LocalPlayer then return end
    if ESPObjects[player] then return end
    
    local drawings = {
        Box = Drawing.new("Square"),
        HealthBar = Drawing.new("Square"),
        HealthBarOutline = Drawing.new("Square"),
        Name = Drawing.new("Text"),
        Distance = Drawing.new("Text")
    }
    
    drawings.Box.Thickness = 2
    drawings.Box.Filled = false
    drawings.Box.Color = getESPColor(player)
    drawings.Box.Transparency = 1
    drawings.Box.Visible = false
    drawings.Box.ZIndex = 1
    
    drawings.HealthBarOutline.Thickness = 1
    drawings.HealthBarOutline.Filled = false
    drawings.HealthBarOutline.Color = Color3.fromRGB(0, 0, 0)
    drawings.HealthBarOutline.Transparency = 1
    drawings.HealthBarOutline.Visible = false
    drawings.HealthBarOutline.ZIndex = 1
    
    drawings.HealthBar.Thickness = 1
    drawings.HealthBar.Filled = true
    drawings.HealthBar.Color = Color3.fromRGB(0, 255, 0)
    drawings.HealthBar.Transparency = 1
    drawings.HealthBar.Visible = false
    drawings.HealthBar.ZIndex = 2
    
    drawings.Name.Center = true
    drawings.Name.Outline = true
    drawings.Name.OutlineColor = Color3.fromRGB(0, 0, 0)
    drawings.Name.Color = Color3.fromRGB(255, 255, 255)
    drawings.Name.Size = 13
    drawings.Name.Font = 2
    drawings.Name.Transparency = 1
    drawings.Name.Visible = false
    drawings.Name.ZIndex = 3
    
    drawings.Distance.Center = true
    drawings.Distance.Outline = true
    drawings.Distance.OutlineColor = Color3.fromRGB(0, 0, 0)
    drawings.Distance.Color = Color3.fromRGB(200, 200, 200)
    drawings.Distance.Size = 12
    drawings.Distance.Font = 2
    drawings.Distance.Transparency = 1
    drawings.Distance.Visible = false
    drawings.Distance.ZIndex = 3
    
    ESPObjects[player] = drawings
end

local function removeESP(player)
    if ESPObjects[player] then
        pcall(function()
            ESPObjects[player].Box:Remove()
            ESPObjects[player].HealthBar:Remove()
            ESPObjects[player].HealthBarOutline:Remove()
            ESPObjects[player].Name:Remove()
            ESPObjects[player].Distance:Remove()
        end)
        ESPObjects[player] = nil
    end
end

local function updateESP()
    if not Config.ESP.Enabled then
        for _, drawings in pairs(ESPObjects) do
            if drawings.Box.Visible then
                drawings.Box.Visible = false
                drawings.HealthBar.Visible = false
                drawings.HealthBarOutline.Visible = false
                drawings.Name.Visible = false
                drawings.Distance.Visible = false
            end
        end
        return
    end
    
    for player, drawings in pairs(ESPObjects) do
        pcall(function()
            if not player or not player.Parent or not player.Character then
                if drawings.Box.Visible then
                    drawings.Box.Visible = false
                    drawings.HealthBar.Visible = false
                    drawings.HealthBarOutline.Visible = false
                    drawings.Name.Visible = false
                    drawings.Distance.Visible = false
                end
                return
            end
            
            local character = player.Character
            local humanoid = character:FindFirstChild("Humanoid")
            local rootPart = character:FindFirstChild("HumanoidRootPart")
            local head = character:FindFirstChild("Head")
            
            if not humanoid or humanoid.Health <= 0 or not rootPart or not head then
                if drawings.Box.Visible then
                    drawings.Box.Visible = false
                    drawings.HealthBar.Visible = false
                    drawings.HealthBarOutline.Visible = false
                    drawings.Name.Visible = false
                    drawings.Distance.Visible = false
                end
                return
            end
            
            local hrpPos = rootPart.Position
            local headPos = head.Position + Vector3.new(0, 0.5, 0)
            local legPos = hrpPos - Vector3.new(0, 3, 0)
            
            local headVector, onScreenHead = Camera:WorldToViewportPoint(headPos)
            local legVector, onScreenLeg = Camera:WorldToViewportPoint(legPos)
            
            if not onScreenHead or headVector.Z <= 0 then
                if drawings.Box.Visible then
                    drawings.Box.Visible = false
                    drawings.HealthBar.Visible = false
                    drawings.HealthBarOutline.Visible = false
                    drawings.Name.Visible = false
                    drawings.Distance.Visible = false
                end
                return
            end
            
            local height = math.abs(headVector.Y - legVector.Y)
            local width = height * 0.4
            
            drawings.Box.Color = getESPColor(player)
            drawings.Box.Size = Vector2.new(width, height)
            drawings.Box.Position = Vector2.new(headVector.X - width / 2, headVector.Y)
            drawings.Box.Visible = true
            
            local healthPercent = humanoid.Health / humanoid.MaxHealth
            local healthBarHeight = height
            local healthBarWidth = 5
            local healthBarOffset = 6
            
            drawings.HealthBarOutline.Size = Vector2.new(healthBarWidth + 2, healthBarHeight + 2)
            drawings.HealthBarOutline.Position = Vector2.new(headVector.X - width / 2 - healthBarWidth - healthBarOffset, headVector.Y - 1)
            drawings.HealthBarOutline.Visible = true
            
            drawings.HealthBar.Size = Vector2.new(healthBarWidth, healthBarHeight * healthPercent)
            drawings.HealthBar.Position = Vector2.new(headVector.X - width / 2 - healthBarWidth - healthBarOffset + 1, headVector.Y + healthBarHeight - (healthBarHeight * healthPercent))
            
            if healthPercent > 0.6 then
                drawings.HealthBar.Color = Color3.fromRGB(0, 255, 0)
            elseif healthPercent > 0.3 then
                drawings.HealthBar.Color = Color3.fromRGB(255, 255, 0)
            else
                drawings.HealthBar.Color = Color3.fromRGB(255, 0, 0)
            end
            drawings.HealthBar.Visible = true
            
            if Config.ESP.ShowNames then
                drawings.Name.Text = player.Name
                drawings.Name.Position = Vector2.new(headVector.X, headVector.Y - 16)
                drawings.Name.Visible = true
            else
                drawings.Name.Visible = false
            end
            
            if Config.ESP.ShowDistance then
                local distance = (hrpPos - Camera.CFrame.Position).Magnitude
                drawings.Distance.Text = math.floor(distance) .. "m"
                drawings.Distance.Position = Vector2.new(headVector.X, legVector.Y + 4)
                drawings.Distance.Visible = true
            else
                drawings.Distance.Visible = false
            end
        end)
    end
end

local function createRecognitionMarker(player)
    if not player or not player.Character then return end
    if RecognitionMarkers[player.Name] then return end
    
    pcall(function()
        local head = player.Character:FindFirstChild("Head")
        if not head then return end
        
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "RecognitionMarker"
        billboard.Adornee = head
        billboard.Size = UDim2.new(0, 50, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.AlwaysOnTop = true
        billboard.MaxDistance = math.huge
        billboard.Parent = head
        
        local icon = Instance.new("TextLabel")
        icon.Size = UDim2.new(1, 0, 1, 0)
        icon.BackgroundTransparency = 1
        icon.Text = "ðŸŽ¯"
        icon.TextSize = 40
        icon.TextColor3 = Color3.fromRGB(255, 255, 255)
        icon.TextStrokeTransparency = 0.5
        icon.Font = Enum.Font.SourceSansBold
        icon.Parent = billboard
        
        RecognitionMarkers[player.Name] = billboard
    end)
end

local function removeRecognitionMarker(playerName)
    if RecognitionMarkers[playerName] then
        pcall(function()
            RecognitionMarkers[playerName]:Destroy()
        end)
        RecognitionMarkers[playerName] = nil
    end
end

local function updateRecognitionMarkers()
    for playerName, _ in pairs(Config.Recognition.Players) do
        local player = Players:FindFirstChild(playerName)
        if player and player.Character and Config.Recognition.Enabled then
            if not RecognitionMarkers[playerName] then
                createRecognitionMarker(player)
            end
        else
            removeRecognitionMarker(playerName)
        end
    end
end

local function updateRecognitionStatus()
    local count = 0
    local names = {}
    
    for name, _ in pairs(Config.Recognition.Players) do
        count = count + 1
        table.insert(names, name)
    end
    
    if count == 0 then
        RecStatus.Text = "Nenhum jogador marcado"
        RecStatus.TextColor3 = Color3.fromRGB(150, 150, 150)
    else
        RecStatus.Text = "Marcados (" .. count .. "): " .. table.concat(names, ", ")
        RecStatus.TextColor3 = Color3.fromRGB(100, 255, 100)
    end
end

local function getTargetPart(character)
    local partName = TargetPartMap[Config.Aimbot.TargetPart] or "Head"
    
    local part = character:FindFirstChild(partName)
    if part and part:IsA("BasePart") then
        return part
    end
    
    local fallbacks = {"Head", "UpperTorso", "Torso", "HumanoidRootPart"}
    for _, fallback in ipairs(fallbacks) do
        part = character:FindFirstChild(fallback)
        if part and part:IsA("BasePart") then
            return part
        end
    end
    
    return nil
end

local function isPlayerValid(player)
    if not player or player == LocalPlayer then return false end
    if not player.Character then return false end
    
    local humanoid = player.Character:FindFirstChild("Humanoid")
    if not humanoid or humanoid.Health <= 0 then return false end
    
    if not Config.Aimbot.TeamCheck and gameHasTeams then
        if player.Team and LocalPlayer.Team and player.Team == LocalPlayer.Team then
            return false
        end
    end
    
    return true
end

local function getClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = Config.Aimbot.FOV
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    for _, player in pairs(Players:GetPlayers()) do
        if not isPlayerValid(player) then continue end
        
        local targetPart = getTargetPart(player.Character)
        if not targetPart then continue end
        
        if not Config.Aimbot.IgnoreWalls then
            local origin = Camera.CFrame.Position
            local direction = (targetPart.Position - origin).Unit * 500
            local ray = Ray.new(origin, direction)
            
            local hit = Workspace:FindPartOnRayWithIgnoreList(ray, {LocalPlayer.Character, Camera})
            
            if hit and not player.Character:IsAncestorOf(hit) then
                continue
            end
        end
        
        local screenPos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
        
        if not onScreen or screenPos.Z <= 0 then continue end
        
        local distance = (Vector2.new(screenPos.X, screenPos.Y) - screenCenter).Magnitude
        
        if distance < shortestDistance then
            shortestDistance = distance
            closestPlayer = player
        end
    end
    
    return closestPlayer
end

local lastAimTime = 0
local aimInterval = 0
local consecutiveAimFrames = 0
local maxConsecutiveFrames = math.random(15, 30)

local function aimAtPlayer(player)
    if not player or not player.Character then return end
    
    local currentTime = tick()
    if currentTime - lastAimTime < aimInterval then
        return
    end
    
    consecutiveAimFrames = consecutiveAimFrames + 1
    if consecutiveAimFrames > maxConsecutiveFrames then
        task.wait(math.random(50, 150) / 1000)
        consecutiveAimFrames = 0
        maxConsecutiveFrames = math.random(15, 30)
    end
    
    local targetPart = getTargetPart(player.Character)
    if not targetPart then return end
    
    local targetPosition = targetPart.Position
    
    if Config.Aimbot.Prediction > 0 then
        local rootPart = player.Character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            local velocity = rootPart.Velocity
            local predictionVariation = (Config.Aimbot.Prediction + math.random(-3, 3)) / 100
            targetPosition = targetPosition + (velocity * predictionVariation)
        end
    end
    
    local humanOffset = Vector3.new(
        math.random(-30, 30) / 1000,
        math.random(-30, 30) / 1000,
        math.random(-30, 30) / 1000
    )
    targetPosition = targetPosition + humanOffset
    
    local cameraCFrame = CFrame.new(Camera.CFrame.Position, targetPosition)
    local smoothnessVariation = (Config.Aimbot.Smoothness + math.random(-5, 5)) / 100
    local smoothness = 1 - smoothnessVariation
    
    Camera.CFrame = Camera.CFrame:Lerp(cameraCFrame, math.clamp(smoothness, 0.01, 0.99))
    
    lastAimTime = currentTime
    aimInterval = math.random(5, 20) / 1000
end

local function cleanupPlayer(player)
    removeESP(player)
    removeRecognitionMarker(player.Name)
    
    if PlayerConnections[player] then
        for _, connection in pairs(PlayerConnections[player]) do
            connection:Disconnect()
        end
        PlayerConnections[player] = nil
    end
end

local function setupPlayer(player)
    if player == LocalPlayer then return end
    
    cleanupPlayer(player)
    PlayerConnections[player] = {}
    
    local function onCharacterAdded(character)
        task.wait(0.5)
        
        createESP(player)
        
        if Config.Recognition.Players[player.Name] then
            createRecognitionMarker(player)
        end
        
        local humanoid = character:WaitForChild("Humanoid", 5)
        if humanoid then
            table.insert(PlayerConnections[player], humanoid.Died:Connect(function()
                removeRecognitionMarker(player.Name)
            end))
        end
    end
    
    if player.Character then
        onCharacterAdded(player.Character)
    end
    
    table.insert(PlayerConnections[player], player.CharacterAdded:Connect(onCharacterAdded))
    table.insert(PlayerConnections[player], player.CharacterRemoving:Connect(function()
        removeRecognitionMarker(player.Name)
    end))
    
    table.insert(PlayerConnections[player], player:GetPropertyChangedSignal("Team"):Connect(function() 
        -- Cor atualiza automaticamente no updateESP()
    end))
end

local function toggleButton(toggle, value)
    toggle.Value = value
    toggle.Button.Text = value and "ON" or "OFF"
    toggle.Button.BackgroundColor3 = value and Color3.fromRGB(80, 180, 80) or Color3.fromRGB(180, 80, 80)
end

local function handleSlider(slider, callback)
    local dragging = false
    
    slider.Button.MouseButton1Down:Connect(function()
        dragging = true
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    RunService.RenderStepped:Connect(function()
        if dragging then
            local mousePos = UserInputService:GetMouseLocation()
            local relativePos = mousePos.X - slider.Track.AbsolutePosition.X
            local percentage = math.clamp(relativePos / slider.Track.AbsoluteSize.X, 0, 1)
            local value = math.floor(slider.Min + (percentage * (slider.Max - slider.Min)))
            
            slider.Value = value
            slider.Fill.Size = UDim2.new(percentage, 0, 1, 0)
            slider.ValueLabel.Text = tostring(value) .. slider.Suffix
            
            callback(value)
        end
    end)
end

ESPToggle.Button.MouseButton1Click:Connect(function()
    Config.ESP.Enabled = not Config.ESP.Enabled
    toggleButton(ESPToggle, Config.ESP.Enabled)
end)

TeamCheckToggle.Button.MouseButton1Click:Connect(function()
    Config.ESP.TeamCheck = not Config.ESP.TeamCheck
    toggleButton(TeamCheckToggle, Config.ESP.TeamCheck)
end)

ESPDistanceToggle.Button.MouseButton1Click:Connect(function()
    Config.ESP.ShowDistance = not Config.ESP.ShowDistance
    toggleButton(ESPDistanceToggle, Config.ESP.ShowDistance)
end)

AimToggle.Button.MouseButton1Click:Connect(function()
    Config.Aimbot.Enabled = not Config.Aimbot.Enabled
    toggleButton(AimToggle, Config.Aimbot.Enabled)
    
    if Config.Aimbot.Enabled then
        Config.Aimbot2.Enabled = false
        Config.Aimbot2.Active = false
        toggleButton(Aimbot2Toggle, false)
    end
end)

FOVToggle.Button.MouseButton1Click:Connect(function()
    Config.Aimbot.ShowFOV = not Config.Aimbot.ShowFOV
    toggleButton(FOVToggle, Config.Aimbot.ShowFOV)
end)

AimTeamToggle.Button.MouseButton1Click:Connect(function()
    Config.Aimbot.TeamCheck = not Config.Aimbot.TeamCheck
    toggleButton(AimTeamToggle, Config.Aimbot.TeamCheck)
end)

WallToggle.Button.MouseButton1Click:Connect(function()
    Config.Aimbot.IgnoreWalls = not Config.Aimbot.IgnoreWalls
    toggleButton(WallToggle, Config.Aimbot.IgnoreWalls)
end)

RecogToggle.Button.MouseButton1Click:Connect(function()
    Config.Recognition.Enabled = not Config.Recognition.Enabled
    toggleButton(RecogToggle, Config.Recognition.Enabled)
    
    if Config.Recognition.Enabled then
        updateRecognitionMarkers()
    else
        for name, _ in pairs(RecognitionMarkers) do
            removeRecognitionMarker(name)
        end
    end
end)

SpeedToggle.Button.MouseButton1Click:Connect(function()
    Config.Movement.Speed = not Config.Movement.Speed
    toggleButton(SpeedToggle, Config.Movement.Speed)
    if not Config.Movement.Speed then
        applySpeed()
    end
end)

SpeedLevelSelector.Btn1.MouseButton1Click:Connect(function()
    Config.Movement.SpeedLevel = 1
    SpeedLevelSelector.Btn1.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
    SpeedLevelSelector.Btn2.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    SpeedLevelSelector.Btn3.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    if Config.Movement.Speed then
        applySpeed()
    end
end)

SpeedLevelSelector.Btn2.MouseButton1Click:Connect(function()
    Config.Movement.SpeedLevel = 2
    SpeedLevelSelector.Btn1.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    SpeedLevelSelector.Btn2.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
    SpeedLevelSelector.Btn3.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    if Config.Movement.Speed then
        applySpeed()
    end
end)

SpeedLevelSelector.Btn3.MouseButton1Click:Connect(function()
    Config.Movement.SpeedLevel = 3
    SpeedLevelSelector.Btn1.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    SpeedLevelSelector.Btn2.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    SpeedLevelSelector.Btn3.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
    if Config.Movement.Speed then
        applySpeed()
    end
end)

Aimbot2Toggle.Button.MouseButton1Click:Connect(function()
    Config.Aimbot2.Enabled = not Config.Aimbot2.Enabled
    toggleButton(Aimbot2Toggle, Config.Aimbot2.Enabled)
    
    if Config.Aimbot2.Enabled then
        Config.Aimbot.Enabled = false
        Config.Aimbot.ShowFOV = false
        toggleButton(AimToggle, false)
        toggleButton(FOVToggle, false)
    end
end)

Aimbot2Selector.BtnLeft.MouseButton1Click:Connect(function()
    Config.Aimbot2.MouseButton = "Left"
    Aimbot2Selector.BtnLeft.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
    Aimbot2Selector.BtnRight.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
end)

Aimbot2Selector.BtnRight.MouseButton1Click:Connect(function()
    Config.Aimbot2.MouseButton = "Right"
    Aimbot2Selector.BtnLeft.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    Aimbot2Selector.BtnRight.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
end)

OptToggle.Button.MouseButton1Click:Connect(function()
    Config.Performance.OptimizationEnabled = not Config.Performance.OptimizationEnabled
    toggleButton(OptToggle, Config.Performance.OptimizationEnabled)
    if Config.Performance.OptimizationEnabled then
        applyOptimization()
    else
        applyOptimization()
    end
end)

AimModeSelector.ButtonF.MouseButton1Click:Connect(function()
    Config.Aimbot.Mode = "F"
    CustomKey = nil
    AimModeSelector.ButtonF.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
    AimModeSelector.ButtonCtrl.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    AimModeSelector.ButtonCustom.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    AimModeSelector.ButtonCustom.Text = "CUSTOM"
end)

AimModeSelector.ButtonCtrl.MouseButton1Click:Connect(function()
    Config.Aimbot.Mode = "CTRL"
    CustomKey = nil
    AimModeSelector.ButtonF.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    AimModeSelector.ButtonCtrl.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
    AimModeSelector.ButtonCustom.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    AimModeSelector.ButtonCustom.Text = "CUSTOM"
end)

AimModeSelector.ButtonCustom.MouseButton1Click:Connect(function()
    if WaitingForKey then return end
    
    WaitingForKey = true
    AimModeSelector.ButtonCustom.Text = "..."
    AimModeSelector.ButtonCustom.BackgroundColor3 = Color3.fromRGB(100, 100, 255)
    
    local connection
    connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if input.UserInputType == Enum.UserInputType.Keyboard then
            local keyName = input.KeyCode.Name
            
            if keyName ~= "Unknown" and keyName ~= "Backspace" and keyName ~= "Return" then
                CustomKey = input.KeyCode
                Config.Aimbot.Mode = keyName
                
                AimModeSelector.ButtonCustom.Text = keyName
                AimModeSelector.ButtonF.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
                AimModeSelector.ButtonCtrl.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
                AimModeSelector.ButtonCustom.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
                
                WaitingForKey = false
                connection:Disconnect()
            end
        end
    end)
    
    task.delay(10, function()
        if WaitingForKey then
            WaitingForKey = false
            AimModeSelector.ButtonCustom.Text = "CUSTOM"
            AimModeSelector.ButtonCustom.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
            if connection then
                connection:Disconnect()
            end
        end
    end)
end)

handleSlider(SmoothSlider, function(value)
    Config.Aimbot.Smoothness = value
end)

handleSlider(PredSlider, function(value)
    Config.Aimbot.Prediction = value
end)

handleSlider(FOVSlider, function(value)
    Config.Aimbot.FOV = value
end)

handleSlider(QualitySlider, function(value)
    Config.Performance.QualityLevel = value
    if Config.Performance.OptimizationEnabled then
        applyOptimization()
    end
end)

for targetName, button in pairs(TargetSelector.Buttons) do
    button.MouseButton1Click:Connect(function()
        Config.Aimbot.TargetPart = targetName
        
        for name, btn in pairs(TargetSelector.Buttons) do
            btn.BackgroundColor3 = name == targetName and Color3.fromRGB(255, 140, 0) or Color3.fromRGB(35, 35, 35)
        end
    end)
end

RecAddBtn.MouseButton1Click:Connect(function()
    local username = RecInput.Text
    if username == "" then return end
    
    local foundPlayer = nil
    for _, player in pairs(Players:GetPlayers()) do
        if player.Name:lower() == username:lower() or player.DisplayName:lower() == username:lower() then
            foundPlayer = player
            break
        end
    end
    
    if foundPlayer then
        Config.Recognition.Players[foundPlayer.Name] = true
        RecInput.Text = ""
        updateRecognitionStatus()
        
        if Config.Recognition.Enabled then
            createRecognitionMarker(foundPlayer)
        end
    end
end)

RecRemoveBtn.MouseButton1Click:Connect(function()
    local username = RecInput.Text
    if username == "" then return end
    
    local removed = false
    
    for storedName, _ in pairs(Config.Recognition.Players) do
        local player = Players:FindFirstChild(storedName)
        
        if player then
            if player.Name:lower() == username:lower() or player.DisplayName:lower() == username:lower() then
                Config.Recognition.Players[storedName] = nil
                removeRecognitionMarker(storedName)
                removed = true
                break
            end
        else
            if storedName:lower() == username:lower() then
                Config.Recognition.Players[storedName] = nil
                removeRecognitionMarker(storedName)
                removed = true
                break
            end
        end
    end
    
    if removed then
        RecInput.Text = ""
        updateRecognitionStatus()
    else
        RecStatus.Text = "ERRO: Jogador nao esta marcado!"
        RecStatus.TextColor3 = Color3.fromRGB(255, 100, 100)
        task.wait(2)
        updateRecognitionStatus()
    end
end)

local isMinimized = false

MinimizeBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    
    if isMinimized then
        MainFrame:TweenSize(UDim2.new(0, 400, 0, 50), "Out", "Quad", 0.3, true)
        Content.Visible = false
        MinimizeBtn.Text = "+"
    else
        MainFrame:TweenSize(UDim2.new(0, 400, 0, 600), "Out", "Quad", 0.3, true)
        Content.Visible = true
        MinimizeBtn.Text = "_"
    end
end)

CloseBtn.MouseButton1Click:Connect(function()
    Config.ESP.Enabled = false
    Config.Aimbot.Enabled = false
    Config.Aimbot.Active = false
    Config.Aimbot2.Enabled = false
    Config.Aimbot2.Active = false
    Config.Recognition.Enabled = false
    Config.Movement.Speed = false
    Config.Performance.OptimizationEnabled = false
    
    applySpeed()
    applyOptimization()
    
    for player, drawings in pairs(ESPObjects) do
        pcall(function()
            drawings.Box:Remove()
            drawings.HealthBar:Remove()
            drawings.HealthBarOutline:Remove()
            drawings.Name:Remove()
            drawings.Distance:Remove()
        end)
    end
    ESPObjects = {}
    
    for name, marker in pairs(RecognitionMarkers) do
        pcall(function()
            marker:Destroy()
        end)
    end
    RecognitionMarkers = {}
    
    for player, connections in pairs(PlayerConnections) do
        for _, connection in pairs(connections) do
            pcall(function()
                connection:Disconnect()
            end)
        end
    end
    PlayerConnections = {}
    
    task.wait(0.2)
    
    pcall(function()
        ScreenGui:Destroy()
    end)
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if input.KeyCode == Enum.KeyCode.Insert then
        MainFrame.Visible = not MainFrame.Visible
    end
    
    if input.KeyCode == Enum.KeyCode.Delete then
        MainFrame.Visible = false
        FOVCircle.Visible = false
        Config.ESP.Enabled = false
        updateESP()
        
        for name, _ in pairs(RecognitionMarkers) do
            removeRecognitionMarker(name)
        end
    end
    
    if Config.Aimbot2.Enabled then
        if Config.Aimbot2.MouseButton == "Left" and input.UserInputType == Enum.UserInputType.MouseButton1 then
            Config.Aimbot2.Active = true
        elseif Config.Aimbot2.MouseButton == "Right" and input.UserInputType == Enum.UserInputType.MouseButton2 then
            Config.Aimbot2.Active = true
        end
    end
    
    if not Config.Aimbot.Enabled then return end
    
    if Config.Aimbot.Mode == "F" and input.KeyCode == Enum.KeyCode.F then
        Config.Aimbot.Active = true
    elseif Config.Aimbot.Mode == "CTRL" and (input.KeyCode == Enum.KeyCode.LeftControl or input.KeyCode == Enum.KeyCode.RightControl) then
        Config.Aimbot.Active = true
    elseif CustomKey and input.KeyCode == CustomKey then
        Config.Aimbot.Active = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if Config.Aimbot2.MouseButton == "Left" and input.UserInputType == Enum.UserInputType.MouseButton1 then
        Config.Aimbot2.Active = false
    elseif Config.Aimbot2.MouseButton == "Right" and input.UserInputType == Enum.UserInputType.MouseButton2 then
        Config.Aimbot2.Active = false
    end
    
    if Config.Aimbot.Mode == "F" and input.KeyCode == Enum.KeyCode.F then
        Config.Aimbot.Active = false
        consecutiveAimFrames = 0
    elseif Config.Aimbot.Mode == "CTRL" and (input.KeyCode == Enum.KeyCode.LeftControl or input.KeyCode == Enum.KeyCode.RightControl) then
        Config.Aimbot.Active = false
        consecutiveAimFrames = 0
    elseif CustomKey and input.KeyCode == CustomKey then
        Config.Aimbot.Active = false
        consecutiveAimFrames = 0
    end
end)

local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 2
FOVCircle.NumSides = 64
FOVCircle.Radius = Config.Aimbot.FOV
FOVCircle.Filled = false
FOVCircle.Color = Color3.fromRGB(255, 140, 0)
FOVCircle.Transparency = 0.6
FOVCircle.Visible = Config.Aimbot.ShowFOV

local fovPulse = 0
local fovDirection = 1
local espUpdateFrame = 0

RunService.RenderStepped:Connect(function()
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    fovPulse = fovPulse + (0.01 * fovDirection)
    if fovPulse > 0.05 or fovPulse < 0 then
        fovDirection = -fovDirection
    end
    
    local radiusVariation = math.sin(tick() * 2) * 2
    
    FOVCircle.Position = screenCenter
    FOVCircle.Radius = Config.Aimbot.FOV + radiusVariation
    FOVCircle.Transparency = 0.6 + fovPulse
    FOVCircle.Visible = Config.Aimbot.ShowFOV and Config.Aimbot.Enabled
    
    espUpdateFrame = espUpdateFrame + 1
    if espUpdateFrame >= 3 then
        espUpdateFrame = 0
        updateESP()
    end
    
    if Config.Aimbot2.Active and Config.Aimbot2.Enabled then
        local target = getClosestPlayer()
        if target then
            aimAtPlayer(target)
        end
    elseif Config.Aimbot.Active and Config.Aimbot.Enabled then
        local target = getClosestPlayer()
        if target then
            aimAtPlayer(target)
        end
    end
end)

task.spawn(function()
    while task.wait(3) do
        if Config.Recognition.Enabled then
            updateRecognitionMarkers()
        end
    end
end)

task.spawn(function()
    for playerName, _ in pairs(Config.Recognition.Players) do
        local player = Players:FindFirstChild(playerName)
        if player and player.Character then
            createRecognitionMarker(player)
        end
    end
end)

task.spawn(function()
    while task.wait(10) do
        pcall(function()
            local spectators = 0
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LocalPlayer then
                    if player.Character then
                        local humanoid = player.Character:FindFirstChild("Humanoid")
                        if humanoid then
                            local targetPlayer = humanoid.TargetPlayer
                            if targetPlayer == LocalPlayer then
                                spectators = spectators + 1
                            end
                        end
                    end
                end
            end
            
            if spectators > 0 then
                MainFrame.Visible = false
                FOVCircle.Visible = false
            end
        end)
    end
end)

task.spawn(function()
    while task.wait(5) do
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                local humanoid = player.Character:FindFirstChild("Humanoid")
                if humanoid and humanoid.Health > 0 and not ESPObjects[player] then
                    createESP(player)
                end
            end
        end
    end
end)

checkTeams()

for _, player in pairs(Players:GetPlayers()) do
    setupPlayer(player)
end

Players.PlayerAdded:Connect(setupPlayer)
Players.PlayerRemoving:Connect(cleanupPlayer)

LocalPlayer:GetPropertyChangedSignal("Team"):Connect(function()
    checkTeams()
end)

updateRecognitionStatus()
